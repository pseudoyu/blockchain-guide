<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Solidity 智能合约开发 - 玩转 ethers.js # 前言 # 在之前的《Solidity 智能合约开发 - 基础》中，我们学习了 Solidity 的基本语法，并且了解了可以通过 Brownie 与 HardHat 等框架进行调试。而另一篇《Solidity 智能合约开发 - 玩转 Web3.py》中我们也通过 Web3.py 直接与我们本地的 Ganache 节点进行交互了。
原本因为之前比较熟悉 Python 的使用，所以想使用 Brownie 框架进行后续开发。然而经过了一番调研，业界还是使用 HardHat 框架居多，也有更多拓展，且我关注的 Solidity 教程也更新了 Javascript 版本，于是还是打算学习一下。
为了更好了解其原理，也为我们后续更好使用框架打好基础，我们这次通过 ethers.js 来与我们部署在 Alchemy 平台上的 Rinkeby 测试网络进行交互。实现了基础的合约编译、部署至 Rinkeby 网络、与合约交互等功能。
可以点击这里访问本测试 Demo 代码仓库。
ethers.js # ethers.js 是 Javascript 的一个开源库，可以与以太坊网络进行交互，其 GitHub 地址为 ethers.io/ethers.js，可以访问其官方文档进行使用。
安装 # 我们可以通过 yarn 安装 ethers.js，如下：
yarn add ethers 使用 # 使用 require 导入库即可使用"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Solidity 合约开发 - 玩转 ethers.js"><meta property="og:description" content="Solidity 智能合约开发 - 玩转 ethers.js # 前言 # 在之前的《Solidity 智能合约开发 - 基础》中，我们学习了 Solidity 的基本语法，并且了解了可以通过 Brownie 与 HardHat 等框架进行调试。而另一篇《Solidity 智能合约开发 - 玩转 Web3.py》中我们也通过 Web3.py 直接与我们本地的 Ganache 节点进行交互了。
原本因为之前比较熟悉 Python 的使用，所以想使用 Brownie 框架进行后续开发。然而经过了一番调研，业界还是使用 HardHat 框架居多，也有更多拓展，且我关注的 Solidity 教程也更新了 Javascript 版本，于是还是打算学习一下。
为了更好了解其原理，也为我们后续更好使用框架打好基础，我们这次通过 ethers.js 来与我们部署在 Alchemy 平台上的 Rinkeby 测试网络进行交互。实现了基础的合约编译、部署至 Rinkeby 网络、与合约交互等功能。
可以点击这里访问本测试 Demo 代码仓库。
ethers.js # ethers.js 是 Javascript 的一个开源库，可以与以太坊网络进行交互，其 GitHub 地址为 ethers.io/ethers.js，可以访问其官方文档进行使用。
安装 # 我们可以通过 yarn 安装 ethers.js，如下：
yarn add ethers 使用 # 使用 require 导入库即可使用"><meta property="og:type" content="article"><meta property="og:url" content="https://www.pseudoyu.com/blockchain-guide/docs/solidity/learn_solidity_from_scratch_ethersjs/"><meta property="article:section" content="docs"><title>Solidity 合约开发 - 玩转 ethers.js | 区块链入门指南</title><link rel=manifest href=/blockchain-guide/manifest.json><link rel=icon href=/blockchain-guide/favicon.png type=image/x-icon><link rel=stylesheet href=/blockchain-guide/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/blockchain-guide/flexsearch.min.js></script>
<script defer src=/blockchain-guide/zh.search.min.7758dca3d778098e05561d00986b1d2e3d447aef3f51cc2a6b3b3248cebe3962.js integrity="sha256-d1jco9d4CY4FVh0AmGsdLj1Eeu8/UcwqazsySM6+OWI=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/blockchain-guide/><span>区块链入门指南</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><p><strong>开始学习</strong></p><ul><li><a href=/blockchain-guide/docs/study_path/>学习路径</a></li></ul></li><li><p><strong>基础知识</strong></p><ul><li><a href=/blockchain-guide/docs/blockchain/blockchain_basic/>区块链基础知识与关键技术</a></li><li><a href=/blockchain-guide/docs/bitcoin/blockchain_bitcoin_basic/>比特币核心技术解读</a></li><li><a href=/blockchain-guide/docs/ethereum/blockchain_ethereum_basic/>Ethereum 核心技术解读</a></li><li><a href=/blockchain-guide/docs/ethereum/blockchain_ethereum_mpt/>Ethereum MPT 详解</a></li><li><a href=/blockchain-guide/docs/solidity/learn_solidity_from_scratch_basic/>Solidity 智能合约开发 - 基础</a></li><li><a href=/blockchain-guide/docs/solidity/learn_solidity_from_scratch_web3py/>Solidity 智能合约开发 - 玩转 Web3.py</a></li><li><a href=/blockchain-guide/docs/solidity/learn_solidity_from_scratch_ethersjs/ class=active>Solidity 智能合约开发 - 玩转 ethers.js</a></li><li><a href=/blockchain-guide/docs/solidity/learn_solidity_from_scratch_hardhat/>Solidity 智能合约开发 - Hardhat 框架使用</a></li><li><a href=/blockchain-guide/docs/solidity/two_phase_commit_contract_practice_in_solidity/>通过状态锁在 Solidity 智能合约中实现两阶段提交</a></li><li><a href=/blockchain-guide/docs/hyperledger_fabric/blockchain_hyperledger_fabric_structure/>Fabric 系统架构详解</a></li><li><a href=/blockchain-guide/docs/hyperledger_fabric/blockchain_hyperledger_fabric_network/>Fabric 网络与安全体系浅析</a></li><li><a href=/blockchain-guide/docs/hyperledger_fabric/blockchain_hyperledger_fabric_gosdk_event/>Fabric Go SDK 事件分析</a></li></ul></li><li><p><strong>热门技术</strong></p><ul><li><a href=/blockchain-guide/docs/ipfs/blockchain_ipfs_structure/>IPFS 技术分析与思考</a></li><li><a href=/blockchain-guide/docs/ipfs/blockchain_ipfs_practice/>IPFS 本地节点搭建</a></li><li><a href=/blockchain-guide/docs/crosschain/blockchain_crosschain/>跨链技术原理与实战</a></li><li><a href=/blockchain-guide/docs/baas/blockchain_baas_platform/>区块链服务平台 (BaaS) 简介</a></li></ul></li><li><p><strong>开发实战</strong></p></li><li><p><strong>附录：资源</strong></p></li><li><p><a href=https://github.com/pseudoyu/blockchain-guide><strong>Fork on Github</strong></a></p></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/blockchain-guide/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Solidity 合约开发 - 玩转 ethers.js</strong>
<label for=toc-control><img src=/blockchain-guide/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#ethersjs>ethers.js</a><ul><li><a href=#安装>安装</a></li><li><a href=#使用>使用</a></li></ul></li><li><a href=#solidity-合约编译>Solidity 合约编译</a><ul><li><a href=#合约源码>合约源码</a></li><li><a href=#读取合约源文件>读取合约源文件</a></li><li><a href=#获取编译结果>获取编译结果</a></li></ul></li><li><a href=#创建-rinkeby-测试网络环境alchemy>创建 Rinkeby 测试网络环境（Alchemy）</a><ul><li><a href=#alchemy-平台>Alchemy 平台</a></li></ul></li><li><a href=#创建-rinkeby-测试账户metamask>创建 Rinkeby 测试账户（MetaMask）</a><ul><li><a href=#metamask>MetaMask</a></li><li><a href=#获取测试-token>获取测试 Token</a></li></ul></li><li><a href=#连接测试节点与钱包>连接测试节点与钱包</a><ul><li><a href=#连接节点>连接节点</a></li><li><a href=#连接钱包>连接钱包</a></li></ul></li><li><a href=#solidity-合约部署>Solidity 合约部署</a><ul><li><a href=#创建合约>创建合约</a></li><li><a href=#部署合约>部署合约</a></li><li><a href=#与合约交互>与合约交互</a></li><li><a href=#从-raw-data-构造交易>从 raw data 构造交易</a></li></ul></li><li><a href=#总结>总结</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></aside></header><article class=markdown><h1 id=solidity-智能合约开发---玩转-ethersjs>Solidity 智能合约开发 - 玩转 ethers.js
<a class=anchor href=#solidity-%e6%99%ba%e8%83%bd%e5%90%88%e7%ba%a6%e5%bc%80%e5%8f%91---%e7%8e%a9%e8%bd%ac-ethersjs>#</a></h1><h2 id=前言>前言
<a class=anchor href=#%e5%89%8d%e8%a8%80>#</a></h2><p>在之前的《<a href=https://www.pseudoyu.com/zh/2022/05/25/learn_solidity_from_scratch_basic/>Solidity 智能合约开发 - 基础</a>》中，我们学习了 Solidity 的基本语法，并且了解了可以通过 <a href=https://github.com/eth-brownie/brownie>Brownie</a> 与 <a href=https://github.com/NomicFoundation/hardhat>HardHat</a> 等框架进行调试。而另一篇《<a href=https://www.pseudoyu.com/zh/2022/05/30/learn_solidity_from_scratch_web3py/>Solidity 智能合约开发 - 玩转 Web3.py</a>》中我们也通过 Web3.py 直接与我们本地的 Ganache 节点进行交互了。</p><p>原本因为之前比较熟悉 Python 的使用，所以想使用 Brownie 框架进行后续开发。然而经过了一番调研，业界还是使用 HardHat 框架居多，也有更多拓展，且我关注的 Solidity 教程也更新了 <a href="https://www.youtube.com/watch?v=gyMwXuJrbJQ">Javascript 版本</a>，于是还是打算学习一下。</p><p>为了更好了解其原理，也为我们后续更好使用框架打好基础，我们这次通过 <a href=https://github.com/ethers-io/ethers.js/>ethers.js</a> 来与我们部署在 <a href=https://dashboard.alchemyapi.io>Alchemy</a> 平台上的 Rinkeby 测试网络进行交互。实现了基础的合约编译、部署至 Rinkeby 网络、与合约交互等功能。</p><p>可以点击<a href=https://github.com/pseudoyu/learn-solidity/tree/master/ethers_simple_storage>这里</a>访问本测试 Demo 代码仓库。</p><h2 id=ethersjs>ethers.js
<a class=anchor href=#ethersjs>#</a></h2><p>ethers.js 是 Javascript 的一个开源库，可以与以太坊网络进行交互，其 GitHub 地址为 <a href=https://github.com/ethers-io/ethers.js/>ethers.io/ethers.js</a>，可以访问其<a href=https://docs.ethers.io/>官方文档</a>进行使用。</p><h3 id=安装>安装
<a class=anchor href=#%e5%ae%89%e8%a3%85>#</a></h3><p>我们可以通过 yarn 安装 <code>ethers.js</code>，如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yarn add ethers
</span></span></code></pre></div><p><img src=https://cdn.jsdelivr.net/gh/pseudoyu/image-hosting@master/images/yarn_add_ethers.png alt=yarn_add_ethers></p><h3 id=使用>使用
<a class=anchor href=#%e4%bd%bf%e7%94%a8>#</a></h3><p>使用 <code>require</code> 导入库即可使用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ethers</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;ethers&#39;</span>);
</span></span></code></pre></div><h2 id=solidity-合约编译>Solidity 合约编译
<a class=anchor href=#solidity-%e5%90%88%e7%ba%a6%e7%bc%96%e8%af%91>#</a></h2><h3 id=合约源码>合约源码
<a class=anchor href=#%e5%90%88%e7%ba%a6%e6%ba%90%e7%a0%81>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-solidity data-lang=solidity><span style=display:flex><span><span style=color:#75715e>// SPDX-License-Identifier: MIT
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pragma solidity</span> <span style=color:#f92672>^</span><span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>8</span>.<span style=color:#ae81ff>7</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>contract</span> <span style=color:#a6e22e>SimpleStorage</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>uint256</span> favoriteNumber;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> favoriteBool;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>People</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>uint256</span> favoriteNumber;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>string</span> name;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    People <span style=color:#66d9ef>public</span> person <span style=color:#f92672>=</span> People({favoriteNumber<span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>, name<span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Arthur&#34;</span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    People[] <span style=color:#66d9ef>public</span> people;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>mapping</span>(<span style=color:#66d9ef>string</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>uint256</span>) <span style=color:#66d9ef>public</span> nameToFavoriteNumber;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>store</span>(<span style=color:#66d9ef>uint256</span> _favoriteNumber) <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>returns</span> (<span style=color:#66d9ef>uint256</span>) {
</span></span><span style=display:flex><span>        favoriteNumber <span style=color:#f92672>=</span> _favoriteNumber;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> favoriteNumber;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>retrieve</span>() <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>view</span> <span style=color:#66d9ef>returns</span> (<span style=color:#66d9ef>uint256</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> favoriteNumber;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>addPerson</span>(<span style=color:#66d9ef>string</span> <span style=color:#66d9ef>memory</span> _name, <span style=color:#66d9ef>uint256</span> _favoriteNumber) <span style=color:#66d9ef>public</span> {
</span></span><span style=display:flex><span>        people.push(People({favoriteNumber<span style=color:#f92672>:</span> _favoriteNumber, name<span style=color:#f92672>:</span> _name}));
</span></span><span style=display:flex><span>        nameToFavoriteNumber[_name] <span style=color:#f92672>=</span> _favoriteNumber;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这是一个简单的存储合约，通过一个 People 结构体对象来存储人名和他喜欢数字，通过一个数组来存储多个人的信息，并提供了添加、查找方法。</p><h3 id=读取合约源文件>读取合约源文件
<a class=anchor href=#%e8%af%bb%e5%8f%96%e5%90%88%e7%ba%a6%e6%ba%90%e6%96%87%e4%bb%b6>#</a></h3><p>当我们通过 VSCode 或其他编辑器完成 Solidity 合约编写与语法检查后，需要编译合约为 abi 文件与 bytecode。</p><p>我们可以通过 <code>yarn</code> 安装 <code>solc</code> 命令行工具进行编辑，并且可以选择对应版本，命令如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yarn add solc@0.8.7-fixed
</span></span></code></pre></div><p>安装完成后，，我们可以通过 <code>solcjs</code> 命令来进行编译，命令如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yarn solcjs --bin --abi --include-path node_modules/ --base-path . -o . SimpleStorage.sol
</span></span></code></pre></div><p>因为编译合约是一个高频操作，我们可以在 <code>package.json</code> 中配置 <code>compile</code> 脚本命令，如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;scripts&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;compile&#34;</span>: <span style=color:#e6db74>&#34;yarn solcjs --bin --abi --include-path node_modules/ --base-path . -o . SimpleStorage.sol&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>之后仅需执行 <code>yarn compile</code> 即可生成合约编译文件。</p><h3 id=获取编译结果>获取编译结果
<a class=anchor href=#%e8%8e%b7%e5%8f%96%e7%bc%96%e8%af%91%e7%bb%93%e6%9e%9c>#</a></h3><p>编译完成后会生成 abi 和 bytecode 文件，分别以 <code>.bin</code> 和 <code>.abi</code> 为后缀。</p><h4 id=获取-bytecode-与-abi>获取 bytecode 与 abi
<a class=anchor href=#%e8%8e%b7%e5%8f%96-bytecode-%e4%b8%8e-abi>#</a></h4><p>Solidity 合约的部署与交互需要 bytecode 与 abi 两个部分，我们可以通过通过以下代码将其写入对应变量供后续操作使用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs-extra&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>abi</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#e6db74>&#34;./SimpleStorage_sol_SimpleStorage.abi&#34;</span>, <span style=color:#e6db74>&#34;utf-8&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>binary</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>readFileSync</span>(<span style=color:#e6db74>&#34;./SimpleStorage_sol_SimpleStorage.bin&#34;</span>, <span style=color:#e6db74>&#34;utf-8&#34;</span>);
</span></span></code></pre></div><h2 id=创建-rinkeby-测试网络环境alchemy>创建 Rinkeby 测试网络环境（Alchemy）
<a class=anchor href=#%e5%88%9b%e5%bb%ba-rinkeby-%e6%b5%8b%e8%af%95%e7%bd%91%e7%bb%9c%e7%8e%af%e5%a2%83alchemy>#</a></h2><p>智能合约的调试需要将合约部署到实际的链上，我们选择部署到 Alchemy 平台的 Rinkeby 测试网进行后续调试开发，</p><h3 id=alchemy-平台>Alchemy 平台
<a class=anchor href=#alchemy-%e5%b9%b3%e5%8f%b0>#</a></h3><p>首先我们访问 <a href=https://dashboard.alchemyapi.io>Alchemy 官网</a>，注册并登录，会看到其 Dashboard，会展示所有已创建的应用。</p><p><img src=https://cdn.jsdelivr.net/gh/pseudoyu/image-hosting@master/images/alchemy_dashboard.png alt=alchemy_dashboard></p><p>安装完成后选择 Create App 即可快速创建一个 Rinkeby 测试网络节点。</p><p><img src=https://cdn.jsdelivr.net/gh/pseudoyu/image-hosting@master/images/alchemy_create_app.png alt=alchemy_create_app></p><p>创建完成后，点击 View Details，可以看到我们刚创建的 App 详细信息，点击右上角 View Key，可以查询我们的节点信息，我们需要记录下 HTTP URL，供后续连接使用。</p><p><img src=https://cdn.jsdelivr.net/gh/pseudoyu/image-hosting@master/images/alchemy_app_detail.png alt=alchemy_app_detail></p><h2 id=创建-rinkeby-测试账户metamask>创建 Rinkeby 测试账户（MetaMask）
<a class=anchor href=#%e5%88%9b%e5%bb%ba-rinkeby-%e6%b5%8b%e8%af%95%e8%b4%a6%e6%88%b7metamask>#</a></h2><h3 id=metamask>MetaMask
<a class=anchor href=#metamask>#</a></h3><p>完成了 Rinkeby 测试网络环境的创建，我们需要通过 MetaMask 创建账户，获取一些测试 Token，并且将账户私钥记录下来，以便后续使用。</p><p><img src=https://cdn.jsdelivr.net/gh/pseudoyu/image-hosting@master/images/metamask_private_key.png alt=metamask_private_key></p><h3 id=获取测试-token>获取测试 Token
<a class=anchor href=#%e8%8e%b7%e5%8f%96%e6%b5%8b%e8%af%95-token>#</a></h3><p>创建账户后，我们需要一些测试 Token 来进行后续开发调试，我们可以通过以下网址获取：</p><ul><li><a href=https://faucets.chain.link>https://faucets.chain.link</a></li><li><a href=https://rinkebyfaucet.com/>https://rinkebyfaucet.com/</a></li></ul><h2 id=连接测试节点与钱包>连接测试节点与钱包
<a class=anchor href=#%e8%bf%9e%e6%8e%a5%e6%b5%8b%e8%af%95%e8%8a%82%e7%82%b9%e4%b8%8e%e9%92%b1%e5%8c%85>#</a></h2><h3 id=连接节点>连接节点
<a class=anchor href=#%e8%bf%9e%e6%8e%a5%e8%8a%82%e7%82%b9>#</a></h3><p><code>ethers.js</code> 提供了库可以方便地连接到我们的测试节点，其中 <code>process.env.ALCHEMY_RPC_URL</code> 为我们在 Alchemy 平台创建 App 的 HTTP URL：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ethers</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;ethers&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>provider</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ethers</span>.<span style=color:#a6e22e>providers</span>.<span style=color:#a6e22e>JsonRpcProvider</span>(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>ALCHEMY_RPC_URL</span>);
</span></span></code></pre></div><h3 id=连接钱包>连接钱包
<a class=anchor href=#%e8%bf%9e%e6%8e%a5%e9%92%b1%e5%8c%85>#</a></h3><p><code>ethers.js</code> 也提供了方法可以连接到我们的测试钱包，其中 <code>process.env.RINKEBY_PRIVATE_KEY</code> 为我们从 MetaMask 复制的私钥。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ethers</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;ethers&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>wallet</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ethers</span>.<span style=color:#a6e22e>Wallet</span>(
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>RINKEBY_PRIVATE_KEY</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>provider</span>
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><h2 id=solidity-合约部署>Solidity 合约部署
<a class=anchor href=#solidity-%e5%90%88%e7%ba%a6%e9%83%a8%e7%bd%b2>#</a></h2><h3 id=创建合约>创建合约
<a class=anchor href=#%e5%88%9b%e5%bb%ba%e5%90%88%e7%ba%a6>#</a></h3><p>我们可以通过 <code>ethers.js</code> 库创建合约。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>contractFactory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ethers</span>.<span style=color:#a6e22e>ContractFactory</span>(<span style=color:#a6e22e>abi</span>, <span style=color:#a6e22e>binary</span>, <span style=color:#a6e22e>wallet</span>);
</span></span></code></pre></div><h3 id=部署合约>部署合约
<a class=anchor href=#%e9%83%a8%e7%bd%b2%e5%90%88%e7%ba%a6>#</a></h3><p>下面我们介绍一下如何通过 <code>ethers.js</code> 库部署合约，其中 <code>SimpleStorage</code> 合约的 ABI 和 BIN 文件已经在上面的代码中读取过了。</p><h4 id=创建合约-1>创建合约
<a class=anchor href=#%e5%88%9b%e5%bb%ba%e5%90%88%e7%ba%a6-1>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>contractFactory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ethers</span>.<span style=color:#a6e22e>ContractFactory</span>(<span style=color:#a6e22e>abi</span>, <span style=color:#a6e22e>binary</span>, <span style=color:#a6e22e>wallet</span>);
</span></span></code></pre></div><h4 id=部署合约-1>部署合约
<a class=anchor href=#%e9%83%a8%e7%bd%b2%e5%90%88%e7%ba%a6-1>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>contract</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>contractFactory</span>.<span style=color:#a6e22e>deploy</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>contract</span>.<span style=color:#a6e22e>deployTransaction</span>.<span style=color:#a6e22e>wait</span>(<span style=color:#ae81ff>1</span>);
</span></span></code></pre></div><h3 id=与合约交互>与合约交互
<a class=anchor href=#%e4%b8%8e%e5%90%88%e7%ba%a6%e4%ba%a4%e4%ba%92>#</a></h3><p>我们也可以通过 <code>ethers.js</code> 来与合约进行交互。</p><h4 id=retrieve>retrieve()
<a class=anchor href=#retrieve>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>currentFavoriteNumber</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>contract</span>.<span style=color:#a6e22e>retrieve</span>();
</span></span></code></pre></div><h4 id=store>store()
<a class=anchor href=#store>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>transactionResponse</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>contract</span>.<span style=color:#a6e22e>store</span>(<span style=color:#e6db74>&#34;7&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>transactionReceipt</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>transactionResponse</span>.<span style=color:#a6e22e>wait</span>(<span style=color:#ae81ff>1</span>);
</span></span></code></pre></div><h3 id=从-raw-data-构造交易>从 raw data 构造交易
<a class=anchor href=#%e4%bb%8e-raw-data-%e6%9e%84%e9%80%a0%e4%ba%a4%e6%98%93>#</a></h3><p>除了直接调用部署合约方法等，我们也可以自己构造交易。</p><h4 id=构造交易>构造交易
<a class=anchor href=#%e6%9e%84%e9%80%a0%e4%ba%a4%e6%98%93>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>nonce</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>wallet</span>.<span style=color:#a6e22e>getTransactionCount</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tx</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>nonce</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>nonce</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>gasPrice</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>20000000000</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>gasLimit</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1000000</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;0x&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>binary</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>chainId</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1337</span>,
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h4 id=签名交易>签名交易
<a class=anchor href=#%e7%ad%be%e5%90%8d%e4%ba%a4%e6%98%93>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>signedTx</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>wallet</span>.<span style=color:#a6e22e>signTransaction</span>(<span style=color:#a6e22e>tx</span>);
</span></span></code></pre></div><h4 id=发送交易>发送交易
<a class=anchor href=#%e5%8f%91%e9%80%81%e4%ba%a4%e6%98%93>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sentTxResponse</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>wallet</span>.<span style=color:#a6e22e>sendTransaction</span>(<span style=color:#a6e22e>tx</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>sentTxResponse</span>.<span style=color:#a6e22e>wait</span>(<span style=color:#ae81ff>1</span>);
</span></span></code></pre></div><h2 id=总结>总结
<a class=anchor href=#%e6%80%bb%e7%bb%93>#</a></h2><p>以上就是我们通过 <code>ethers.js</code> 库与 Alchemy 的 Rinkeby 测试网络进行交互的步骤，在真正的生产项目开发中我们一般不会直接使用 <code>ethers.js</code> 这样的库，而是会使用 Brownie、HardHat 这样进一步封装的框架，但了解 <code>Web3.py</code> 或 <code>ethers.js</code> 等库的使用方法也非常重要。后续我还会对 HardHat 框架的使用作进一步讲解。</p><h2 id=参考资料>参考资料
<a class=anchor href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99>#</a></h2><blockquote><ol><li><a href=https://www.pseudoyu.com/zh/2022/05/25/learn_solidity_from_scratch_basic/>Solidity 智能合约开发 - 基础</a></li><li><a href=https://www.pseudoyu.com/zh/2022/05/30/learn_solidity_from_scratch_web3py/>Solidity 智能合约开发 - 玩转 Web3.py</a></li><li><a href="https://www.youtube.com/watch?v=gyMwXuJrbJQ">Solidity, Blockchain, and Smart Contract - Javascript 版本</a></li><li><a href=https://github.com/ethers-io/ethers.js/>ethers.js 项目仓库</a></li><li><a href=https://docs.ethers.io/>ethers.js 官方文档</a></li><li><a href=https://dashboard.alchemyapi.io>Alchemy 官网</a></li></ol></blockquote></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#ethersjs>ethers.js</a><ul><li><a href=#安装>安装</a></li><li><a href=#使用>使用</a></li></ul></li><li><a href=#solidity-合约编译>Solidity 合约编译</a><ul><li><a href=#合约源码>合约源码</a></li><li><a href=#读取合约源文件>读取合约源文件</a></li><li><a href=#获取编译结果>获取编译结果</a></li></ul></li><li><a href=#创建-rinkeby-测试网络环境alchemy>创建 Rinkeby 测试网络环境（Alchemy）</a><ul><li><a href=#alchemy-平台>Alchemy 平台</a></li></ul></li><li><a href=#创建-rinkeby-测试账户metamask>创建 Rinkeby 测试账户（MetaMask）</a><ul><li><a href=#metamask>MetaMask</a></li><li><a href=#获取测试-token>获取测试 Token</a></li></ul></li><li><a href=#连接测试节点与钱包>连接测试节点与钱包</a><ul><li><a href=#连接节点>连接节点</a></li><li><a href=#连接钱包>连接钱包</a></li></ul></li><li><a href=#solidity-合约部署>Solidity 合约部署</a><ul><li><a href=#创建合约>创建合约</a></li><li><a href=#部署合约>部署合约</a></li><li><a href=#与合约交互>与合约交互</a></li><li><a href=#从-raw-data-构造交易>从 raw data 构造交易</a></li></ul></li><li><a href=#总结>总结</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav></div></aside></main></body></html>